<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ¶ AnimalsSum | AI äººå¯µé…å°</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- AI Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>

    <style>
        :root {
            --primary: #54b97c;
            --primary-dark: #3da065;
            --accent: #FFB703;
            --bg-gradient: linear-gradient(135deg, #f6fffa 0%, #e1f5fe 100%);
            --glass: rgba(255, 255, 255, 0.95);
            --shadow: 0 10px 30px rgba(84, 185, 124, 0.15);
        }

        body {
            font-family: 'Noto Sans TC', 'Fredoka', sans-serif;
            background: var(--bg-gradient);
            color: #444;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .app-container {
            background: var(--glass);
            width: 100%;
            max-width: 500px;
            border-radius: 30px;
            padding: 30px 20px;
            box-shadow: var(--shadow);
            position: relative;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.8);
            margin-top: 10px;
        }

        /* Header */
        header { text-align: center; margin-bottom: 30px; }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary); letter-spacing: 1px; }
        h1 { margin: 10px 0 5px; font-size: 1.8rem; color: #333; }
        .subtitle { color: #888; font-size: 0.9rem; margin: 0; }

        /* Upload Grid */
        .upload-grid {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 25px;
        }

        .upload-box {
            flex: 1;
            aspect-ratio: 1/1;
            background: #fff;
            border-radius: 20px;
            border: 3px dashed #ddd;
            position: relative;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .upload-box:hover, .upload-box.has-img {
            border-color: var(--primary);
            border-style: solid;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .upload-box img {
            width: 100%; height: 100%; object-fit: cover;
            position: absolute; top: 0; left: 0;
            display: none;
        }

        .upload-icon { font-size: 2rem; color: #ddd; margin-bottom: 5px; transition: 0.3s; }
        .upload-label { font-size: 0.9rem; font-weight: bold; color: #aaa; transition: 0.3s; }
        .upload-box:hover .upload-icon { color: var(--primary); }
        .upload-box:hover .upload-label { color: var(--primary); }

        /* Bubbles */
        .status-bubble {
            position: absolute; bottom: -15px; left: 50%; transform: translateX(-50%);
            background: #333; color: #fff; font-size: 0.75rem; padding: 4px 12px;
            border-radius: 12px; white-space: nowrap; opacity: 0; transition: 0.3s;
            pointer-events: none; z-index: 10;
        }
        .status-bubble.show { opacity: 1; bottom: 10px; }
        .status-bubble.error { background: #ef5350; }
        .status-bubble.success { background: var(--primary); }

        /* Main Button */
        .action-btn {
            width: 100%;
            background: var(--primary);
            color: white;
            border: none;
            padding: 16px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(84, 185, 124, 0.4);
            transition: transform 0.2s, background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .action-btn:active { transform: scale(0.98); }
        .action-btn:disabled { background: #ccc; box-shadow: none; cursor: not-allowed; opacity: 0.7; }

        /* Sections */
        .section-card {
            background: #fff;
            padding: 25px;
            border-radius: 25px;
            margin-top: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.03);
            display: none; /* Hidden by default */
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Personality Tags */
        .tags-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 15px; }
        .tag {
            background: #f0f7f4; border: 1px solid #e0e0e0;
            padding: 8px 15px; border-radius: 12px;
            font-size: 0.9rem; color: #555; cursor: pointer;
            transition: 0.2s; user-select: none;
        }
        .tag.selected {
            background: var(--primary); color: white; border-color: var(--primary);
            box-shadow: 0 3px 10px rgba(84, 185, 124, 0.3);
        }

        /* Result Score */
        .score-display {
            text-align: center; margin-bottom: 20px;
            position: relative;
        }
        .score-val {
            font-size: 5rem; font-weight: 800; color: var(--primary);
            line-height: 1; text-shadow: 2px 2px 0px #ebf9f0;
        }
        .score-label { font-size: 1.2rem; font-weight: bold; color: var(--accent); }

        /* Bars */
        .stat-item { margin-bottom: 12px; display: flex; align-items: center; gap: 10px; font-size: 0.9rem; }
        .stat-bar { flex: 1; height: 8px; background: #eee; border-radius: 4px; overflow: hidden; }
        .stat-fill { height: 100%; width: 0%; background: var(--primary); transition: width 1s cubic-bezier(0.1, 0.7, 1.0, 0.1); }

        /* Form for Data Collection */
        .data-form { margin-top: 20px; padding-top: 20px; border-top: 1px dashed #eee; }
        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group label { display: block; font-size: 0.85rem; font-weight: bold; color: #666; margin-bottom: 5px; }
        .form-input { 
            width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 12px; 
            font-family: inherit; font-size: 0.95rem; box-sizing: border-box;
            transition: 0.3s;
        }
        .form-input:focus { border-color: var(--primary); outline: none; }

        /* Loading Overlay */
        #loader {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9); border-radius: 30px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 100; display: none;
        }
        .spinner {
            width: 40px; height: 40px; border: 4px solid #eee; border-top-color: var(--primary);
            border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div class="app-container">
        
        <!-- Loading Overlay -->
        <div id="loader">
            <div class="spinner"></div>
            <p id="loader-text" style="font-weight:bold; color:#555;">æ­£åœ¨å–šé†’ AI...</p>
        </div>

        <header>
            <div class="logo">ğŸ¾ ANIMALSSUM</div>
            <h1>AI äººå¯µé…å°</h1>
            <p class="subtitle">å¤§æ•¸æ“šåˆ†æ â€¢ ä½ åŒä¸»å­æœ‰å¹¾ä¼¼ï¼Ÿ</p>
        </header>

        <!-- Image Inputs -->
        <div class="upload-grid">
            <!-- Human -->
            <div class="upload-box" id="box1" onclick="triggerUpload('input1')">
                <div class="upload-icon">ğŸ‘¤</div>
                <div class="upload-label">äººé¡ (ä¸»äºº)</div>
                <img id="img1">
                <div id="status1" class="status-bubble"></div>
                <input type="file" id="input1" accept="image/*" hidden onchange="handleFile(this, 'img1', 'box1', 'human')">
            </div>

            <!-- Pet -->
            <div class="upload-box" id="box2" onclick="triggerUpload('input2')">
                <div class="upload-icon">ğŸ¶</div>
                <div class="upload-label">æ„›å¯µ</div>
                <img id="img2">
                <div id="status2" class="status-bubble"></div>
                <input type="file" id="input2" accept="image/*" hidden onchange="handleFile(this, 'img2', 'box2', 'dog')">
            </div>
        </div>

        <button id="btn-analyze" class="action-btn" onclick="startAnalysis()" disabled>
            âœ¨ é–‹å§‹åˆ†æ
        </button>

        <!-- Phase 2: Traits (Hidden) -->
        <div id="section-traits" class="section-card">
            <h3 style="margin:0;">ğŸ¶ AI ç™¼ç¾å“ç¨®ï¼š<span id="breed-name" style="color:var(--primary);">...</span></h3>
            <p style="font-size:0.9rem; color:#666; margin-top:5px;">ä½ è¦ºå¾—ä½ å“‹æ€§æ ¼ä¼¼å””ä¼¼ï¼Ÿ(å…¨ä¸­æœ‰åŠ ä¹˜!)</p>
            <div class="tags-container" id="traits-list">
                <!-- Tags generated by JS -->
            </div>
            <button class="action-btn" style="margin-top:20px; background:var(--accent);" onclick="showResult()">
                ğŸ“Š ç”Ÿæˆè©³ç´°å ±å‘Š
            </button>
        </div>

        <!-- Phase 3: Result (Hidden) -->
        <div id="section-result" class="section-card" style="text-align:center;">
            <p style="font-size:0.8rem; font-weight:bold; color:#aaa; letter-spacing:1px; margin-bottom:10px;">MATCHING SCORE</p>
            
            <div class="score-display">
                <div class="score-val" id="final-score">0%</div>
                <div class="score-label" id="final-comment">...</div>
            </div>

            <div style="text-align:left; background:#f9f9f9; padding:20px; border-radius:15px; margin-bottom:20px;">
                <div class="stat-item">
                    <span style="width:70px; font-weight:bold;">äº”å®˜</span>
                    <div class="stat-bar"><div class="stat-fill" id="bar-face"></div></div>
                    <span id="val-face">0%</span>
                </div>
                <div class="stat-item">
                    <span style="width:70px; font-weight:bold;">è‰²ç³»</span>
                    <div class="stat-bar"><div class="stat-fill" id="bar-color"></div></div>
                    <span id="val-color">0%</span>
                </div>
                <div class="stat-item">
                    <span style="width:70px; font-weight:bold;">é»˜å¥‘</span>
                    <div class="stat-bar"><div class="stat-fill" id="bar-bond" style="background:var(--accent);"></div></div>
                    <span id="val-bond">0%</span>
                </div>
            </div>

            <!-- Data Collection Form (UI Only for now) -->
            <div class="data-form">
                <h4 style="margin:0 0 15px 0;">ğŸ“¥ ç™»è¨˜é ˜å–é›»å­è­‰æ›¸</h4>
                <div class="form-group">
                    <label>å±…ä½åœ°å€ (ç”¨ä½œå…¨æ¸¯äººå¯µæ’å)</label>
                    <select class="form-input" id="input-district">
                        <option value="">è«‹é¸æ“‡...</option>
                        <option value="central">ä¸­è¥¿å€</option>
                        <option value="eastern">æ±å€</option>
                        <option value="southern">å—å€</option>
                        <option value="wan_chai">ç£ä»”å€</option>
                        <option value="kowloon_city">ä¹é¾åŸå€</option>
                        <option value="kwun_tong">è§€å¡˜å€</option>
                        <option value="sham_shu_po">æ·±æ°´åŸ—å€</option>
                        <option value="wong_tai_sin">é»ƒå¤§ä»™å€</option>
                        <option value="yau_tsim_mong">æ²¹å°–æ—ºå€</option>
                        <option value="islands">é›¢å³¶å€</option>
                        <option value="kwai_tsing">è‘µé’å€</option>
                        <option value="north">åŒ—å€</option>
                        <option value="sai_kung">è¥¿è²¢å€</option>
                        <option value="sha_tin">æ²™ç”°å€</option>
                        <option value="tai_po">å¤§åŸ”å€</option>
                        <option value="tsuen_wan">èƒç£å€</option>
                        <option value="tuen_mun">å±¯é–€å€</option>
                        <option value="yuen_long">å…ƒæœ—å€</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Email (æ¥æ”¶å ±å‘Š)</label>
                    <input type="email" class="form-input" placeholder="example@gmail.com">
                </div>
                <button class="action-btn" onclick="alert('å¤šè¬ç™»è¨˜ï¼Data æ”¶é›†åŠŸèƒ½å°‡æ–¼ä¸‹ä¸€éšæ®µå•Ÿå‹•ï¼')" style="font-size:1rem; padding:12px;">
                    ğŸ“œ ç™»è¨˜ä¸¦ä¸‹è¼‰è­‰æ›¸
                </button>
            </div>
            
            <p style="margin-top:20px; font-size:0.8rem; color:#999; cursor:pointer; text-decoration:underline;" onclick="location.reload()">ğŸ”„ å†ç©ä¸€æ¬¡</p>
        </div>

    </div>

    <!-- Logic Script -->
    <script>
        // Data & Models
        let modelMobileNet, modelCoco;
        const colorThief = new ColorThief();
        let images = { human: null, dog: null };
        let currentBreed = 'Unknown';
        let traitScore = 0;

        const dogKeywords = ['dog', 'terrier', 'retriever', 'spaniel', 'shepherd', 'hound', 'wolf', 'poodle', 'collie', 'beagle', 'corgi', 'husky', 'schnauzer', 'bulldog', 'pug', 'shiba', 'akita'];
        
        const comments = [
            { min: 90, text: "ğŸ˜ 99% å¤±æ•£è¦ªäººï¼" },
            { min: 80, text: "â¤ï¸ é¤…å°ä¸€æ¨£ï¼" },
            { min: 60, text: "ğŸ˜ æ°£å ´å¥½åˆæ‹ï¼" },
            { min: 40, text: "ğŸ¤” äº’è£œå‹æ‹æª”" },
            { min: 0, text: "ğŸ˜‚ å””ä¼¼æ¨£ä½†æœ‰æ„›" }
        ];

        const traitsData = [
            "å¤§å®¶éƒ½å¥½ç‚ºé£Ÿ ğŸ–", "å°äººè¶…ç´šç†±æƒ… ğŸ¤—", "æœ‰æ½”ç™–/è²ªéš âœ¨", 
            "æ¥µåº¦è°æ˜ ğŸ§ ", "æ€§æ ¼å¥½å›ºåŸ· ğŸ‚", "é¾æ„é»ä½å°æ–¹ â¤ï¸", "ç¶“å¸¸ä¸€é½Šç™¼å‘† ğŸ˜¶"
        ];

        // Init Models
        async function loadModels() {
            document.getElementById('loader').style.display = 'flex';
            try {
                modelMobileNet = await mobilenet.load();
                modelCoco = await cocoSsd.load();
                document.getElementById('loader').style.display = 'none';
            } catch (e) {
                alert("AI æ¨¡å‹è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¢ºä¿ç¶²çµ¡æš¢é€š");
                console.error(e);
            }
        }
        // Load on start
        window.addEventListener('DOMContentLoaded', loadModels);

        function triggerUpload(id) { document.getElementById(id).click(); }

        async function handleFile(input, imgId, boxId, type) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById(imgId);
                    img.src = e.target.result;
                    img.style.display = 'block';
                    img.onload = () => validateImage(img, boxId, type);
                    document.getElementById(boxId).classList.add('has-img');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        async function validateImage(img, boxId, type) {
            if (!modelCoco) return;
            const statusEl = document.querySelector(`#${boxId} .status-bubble`);
            statusEl.className = 'status-bubble'; // reset
            
            // Show scanning text
            statusEl.textContent = 'ğŸ” åˆ†æä¸­...';
            statusEl.classList.add('show');

            const predictions = await modelCoco.detect(img);
            let valid = false;
            let msg = '';

            if (type === 'human') {
                const hasPerson = predictions.some(p => p.class === 'person');
                if (hasPerson) { valid = true; msg = 'âœ… æ”¶åˆ°äººé¡'; statusEl.classList.add('success'); }
                else { msg = 'â“ æµå””åˆ°äººæ¨£'; statusEl.classList.add('error'); }
            } else {
                // For pet, check MobileNet for specific breeds if Coco isn't sure
                const hasDog = predictions.some(p => p.class === 'dog' || p.class === 'cat' || p.class === 'bird' || p.class === 'horse' || p.class === 'sheep'); // Expanded animals
                if (hasDog) { 
                    valid = true; msg = 'âœ… æ”¶åˆ°èŒå¯µ'; statusEl.classList.add('success'); 
                } else {
                    // Fallback check
                    const mobs = await modelMobileNet.classify(img);
                    const isMobDog = mobs.some(m => dogKeywords.some(k => m.className.toLowerCase().includes(k)));
                    if(isMobDog) { valid = true; msg = 'âœ… æ”¶åˆ°æ±ªæ˜Ÿäºº'; statusEl.classList.add('success'); }
                    else { msg = 'â“ å””ä¼¼å‹•ç‰©å–'; statusEl.classList.add('error'); }
                }
            }

            statusEl.textContent = msg;
            images[type] = valid ? img : null;
            checkReady();
        }

        function checkReady() {
            const btn = document.getElementById('btn-analyze');
            if (images.human && images.dog) {
                btn.disabled = false;
                btn.innerHTML = "âœ¨ é–‹å§‹åˆ†æ";
            } else {
                btn.disabled = true;
            }
        }

        async function startAnalysis() {
            document.getElementById('loader').style.display = 'flex';
            document.getElementById('loader-text').textContent = "ğŸ§  AI æ­£åœ¨å°æ¯”äº”å®˜æ•¸æ“š...";
            
            const btn = document.getElementById('btn-analyze');
            btn.style.display = 'none'; // Hide button

            // Identify Breed
            const predictions = await modelMobileNet.classify(images.dog);
            currentBreed = predictions[0].className.split(',')[0];
            document.getElementById('breed-name').textContent = currentBreed;

            // Generate Traits
            const list = document.getElementById('traits-list');
            list.innerHTML = '';
            // Pick 4 random traits + ensure generic ones
            traitsData.forEach((t, i) => {
                if (i < 5) {
                    list.innerHTML += `<div class="tag" onclick="toggleTag(this)">${t}</div>`;
                }
            });

            document.getElementById('loader').style.display = 'none';
            document.getElementById('section-traits').style.display = 'block';
            
            // Scroll to traits
            document.getElementById('section-traits').scrollIntoView({ behavior: 'smooth' });
        }

        function toggleTag(el) {
            el.classList.toggle('selected');
            calculateTraitScore();
        }

        function calculateTraitScore() {
            const count = document.querySelectorAll('.tag.selected').length;
            traitScore = count * 5; // 5% per trait
        }

        async function showResult() {
            document.getElementById('section-traits').style.display = 'none';
            document.getElementById('loader').style.display = 'flex';
            document.getElementById('loader-text').textContent = "ğŸ“Š ç”Ÿæˆæœ€çµ‚å ±å‘Š...";

            // Logic Simulation (Advanced logic placeholder)
            // 1. Color Analysis
            const c1 = colorThief.getColor(images.human);
            const c2 = colorThief.getColor(images.dog);
            const colorDist = Math.sqrt(Math.pow(c1[0]-c2[0],2) + Math.pow(c1[1]-c2[1],2) + Math.pow(c1[2]-c2[2],2));
            let scoreColor = Math.max(20, 100 - Math.round(colorDist / 2));

            // 2. Feature Analysis (Pseudo - based on tensor activation simulation)
            // Real facial sim is heavy, we use random seed based on image size as placeholder logic for demo
            let seed = (images.human.width + images.dog.width) % 40; 
            let scoreFace = 50 + seed; // Base 50-90

            // 3. Final Calc
            let total = Math.round((scoreFace * 0.4) + (scoreColor * 0.3) + (traitScore) + 10);
            if (total > 99) total = 99;
            if (total < 10) total = 10;

            setTimeout(() => {
                document.getElementById('loader').style.display = 'none';
                document.getElementById('section-result').style.display = 'block';

                // Animate Numbers
                document.getElementById('final-score').textContent = total + "%";
                const comm = comments.find(c => total >= c.min);
                document.getElementById('final-comment').textContent = comm ? comm.text : "";

                // Animate Bars
                document.getElementById('bar-face').style.width = scoreFace + "%";
                document.getElementById('val-face').textContent = scoreFace + "%";
                
                document.getElementById('bar-color').style.width = scoreColor + "%";
                document.getElementById('val-color').textContent = scoreColor + "%";

                let bond = traitScore + 10;
                document.getElementById('bar-bond').style.width = bond + "%";
                document.getElementById('val-bond').textContent = bond + "%";
                
                document.getElementById('section-result').scrollIntoView({ behavior: 'smooth' });

            }, 800);
        }
    </script>
</body>
</html>